<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Q-Sort</title>

    <link rel="stylesheet" href="q-sort.css" />

    <!-- html2canvas for export PNG -->
    <script defer src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script defer src="q-sort.js"></script>
</head>

<body>
    <!-- Desktop-only blocker -->
    <div class="mobile-block" id="mobileBlock" hidden>
        <div class="mobile-block-card">
            <h2>Desktop required</h2>
            <p>This Q-sort uses drag-and-drop and a dense grid, so it won’t behave well on a phone.</p>
        </div>
    </div>
    <nav class="topnav" role="navigation" aria-label="Q-sort toolbar">
        <div class="topnav-left">
            <strong class="brand">Q-Sort</strong>
            <span class="muted" id="navTitle"></span>
        </div>
        <div class="topnav-right">
            <!-- Keep New as quick-access -->
            <button class="btn ghost" id="navNew" type="button">New</button>

            <!-- Menu button -->
            <div class="menu-wrap">
                <button class="btn ghost" id="navMenuBtn" type="button" aria-haspopup="menu" aria-expanded="false">
                    Menu ▾
                </button>

                <div class="menu hidden" id="navMenu" role="menu" aria-label="Q-sort menu">
                    <div class="menu-group-label">Edit</div>

                    <button class="menu-item" id="menuLabels" type="button" role="menuitem">
                        Edit column labels…
                    </button>

                    <div class="menu-sep"></div>

                    <div class="menu-group-label">Load</div>

                    <label class="menu-item" role="menuitem">
                        Load (JSON)
                        <input id="navLoadFile" type="file" accept="application/json" hidden />
                    </label>

                    <button class="menu-item" id="navLoadLocal" type="button" role="menuitem">
                        Load (local)
                    </button>

                    <div class="menu-sep"></div>
                    <button class="menu-item" id="menuPresets" type="button">
                        Presets…
                    </button>

                    <div class="menu-sep"></div>
                    <div class="menu-group-label">Save</div>

                    <button class="menu-item" id="menuSaveLocal" type="button" role="menuitem">
                        Save (local)
                    </button>

                    <button class="menu-item" id="menuSaveJson" type="button" role="menuitem">
                        Save (JSON)
                    </button>

                    <div class="menu-sep"></div>
                    <div class="menu-group-label">Output</div>

                    <button class="menu-item" id="menuPrint" type="button" role="menuitem">
                        Print
                    </button>

                    <div class="menu-sep"></div>
                    <div class="menu-group-label">Danger</div>

                    <button class="menu-item warn" id="menuClearLocal" type="button" role="menuitem">
                        Clear local
                    </button>
                </div>
            </div>

            <button class="btn ghost" id="navHelp" type="button">Help</button>
        </div>
    </nav>


    <main class="qsort-shell">
        <div id="print-layout">
            <div class="qsort-layout">
                <section class="panel add-panel" aria-label="Add thought">

                    <div class="row">
                        <h2 class="panel-title">Add thought</h2>

                        <div class="controls controls-wrap">

                            <button id="add-thought" class="btn primary" type="button">Add thought (with
                                notes)</button>
                        </div>
                    </div>

                    <!-- Unsorted tray -->
                    <div class="tray">
                        <div class="tray-title">Unsorted thoughts</div>

                        <div id="neutral-thoughts-list" class="thought-list tray-list" aria-label="Unsorted thoughts">
                        </div>

                        <!-- Hidden banks kept for JS compatibility -->
                        <div id="negative-thoughts-list" hidden></div>
                        <div id="positive-thoughts-list" hidden></div>
                    </div>
                    <!-- Bin (drag here to delete) -->
                    <div class="bin-wrap" aria-label="Delete thoughts">
                        <div class="bin-title">Bin</div>
                        <div id="binZone" class="bin-zone" aria-label="Drop thoughts here to delete">
                            Drop here to delete
                        </div>
                    </div>

                </section>

                <!-- Grid -->
                <section class="panel grid-panel" aria-label="Q-sort grid">
                    <div id="q-sort-grid"></div>
                </section>

            </div>

            <!-- Bottom actions -->
            <footer class="bottombar" role="contentinfo" aria-label="Actions">
                <!-- Hidden action buttons (kept for existing JS wiring) -->
                <div class="bottombar-actions-hidden" aria-hidden="true">
                    <button class="btn" id="btnSaveLocal" type="button">Save (local)</button>
                    <button class="btn warn" id="btnClearLocal" type="button">Clear local</button>
                    <button class="btn" id="btnExportJson" type="button">Save (JSON)</button>
                    <button class="btn" id="btnPrintGrid" type="button">Print</button>
                </div>

                <!-- Visible footer info -->
                <span class="muted" id="localStatus" aria-live="polite"></span>
                <span class="muted" id="appVersion"></span>
                Created by Caspar Wynne
            </footer>

            <div id="title-modal" class="modal hidden">
                <div class="modal-box">
                    <h3>Start a new Q-sort</h3>

                    <label>
                        <div class="muted" style="font-weight:600; margin-bottom:6px;">Title / topic</div>
                        <input id="title-input" type="text" />
                    </label>

                    <div class="layout-picker">
                        <div class="muted" style="font-weight:600; margin:12px 0 6px;">Grid layout</div>

                        <!-- JS will populate this -->
                        <div class="layout-grid" id="layoutGrid"></div>
                    </div>

                    <div class="labels-picker">
                        <div class="muted" style="font-weight:600; margin:12px 0 6px;">Column labels</div>

                        <label class="muted" style="display:block; margin:0 0 8px;">
                            Left label
                            <input id="label-left" type="text" maxlength="40" />
                        </label>

                        <label class="muted" style="display:block; margin:0 0 8px;">
                            Centre label
                            <input id="label-centre" type="text" maxlength="40" />
                        </label>

                        <label class="muted" style="display:block;">
                            Right label
                            <input id="label-right" type="text" maxlength="40" />
                        </label>
                    </div>

                    <div class="modal-actions" id="title-actions">
                        <button type="button" class="btn" id="title-cancel">Cancel</button>
                        <button type="button" class="btn primary" id="title-ok">OK</button>
                    </div>

                </div>
            </div>


            <div id="thought-modal" class="modal hidden">
                <div class="modal-box">
                    <h3>Add / Edit thought</h3>

                    <label>
                        Thought title
                        <input id="modal-thought-title" maxlength="80" />
                        <div class="muted" id="title-count">0 / 80</div>
                    </label>

                    <label>
                        Notes
                        <textarea id="modal-thought-notes" rows="6" maxlength="1000"></textarea>
                    </label>

                    <div class="modal-actions">
                        <button id="modal-save" class="btn primary">Save</button>
                        <button id="modal-cancel" class="btn ghost">Cancel</button>
                    </div>
                </div>
            </div>

            <div id="notes-modal" class="modal hidden" aria-hidden="true">
                <div class="modal-box">
                    <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
                        <h3 id="notes-modal-title" style="margin:0;">Thought</h3>

                        <div style="display:flex; gap:8px; align-items:center;">
                            <button id="notes-edit" class="btn ghost" type="button" title="Edit">
                                ✎
                            </button>
                            <button id="notes-close" class="btn ghost" type="button" title="Close">
                                Close
                            </button>
                        </div>
                    </div>

                    <div style="margin-top:12px;">
                        <div class="muted" style="font-weight:600; margin-bottom:6px;">Notes</div>
                        <div id="notes-modal-body" style="white-space:pre-wrap; line-height:1.35;"></div>
                    </div>
                </div>
            </div>

            <div id="labels-modal" class="modal hidden">
                <div class="modal-box">
                    <h3>Edit column labels</h3>

                    <label class="muted" style="display:block; margin:0 0 8px;">
                        Left label
                        <input id="edit-label-left" type="text" maxlength="40" />
                    </label>

                    <label class="muted" style="display:block; margin:0 0 8px;">
                        Centre label
                        <input id="edit-label-centre" type="text" maxlength="40" />
                    </label>

                    <label class="muted" style="display:block;">
                        Right label
                        <input id="edit-label-right" type="text" maxlength="40" />
                    </label>

                    <div class="modal-actions">
                        <button id="labels-save" class="btn primary" type="button">Save</button>
                        <button id="labels-cancel" class="btn ghost" type="button">Cancel</button>
                    </div>
                </div>
            </div>


            <section id="print-notes" class="print-notes" hidden>
                <h3 class="print-notes-title">Notes</h3>
                <div id="print-notes-body"></div>
            </section>
        </div>

        <div id="presets-modal" class="modal hidden">
            <div class="modal-box presets-modal">
                <div class="presets-head">
                    <div>
                        <h3 class="presets-title">Choose a preset</h3>
                        <p class="muted presets-sub">Loads an example Q-sort from this site.</p>
                    </div>
                    <button class="btn" id="presetsClose" type="button">Close</button>
                </div>

                <div class="presets-search">
                    <input id="presetSearch" type="text" placeholder="Search presets…" />
                </div>

                <div class="presets-body">
                    <div class="presets-list" id="presetsList"></div>

                    <div class="presets-detail" id="presetDetail">
                        <div class="muted">Select a preset to see details.</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="help-modal" class="modal hidden" aria-hidden="true">
            <div class="modal-box" role="dialog" aria-modal="true" aria-labelledby="help-title">
                <h3 id="help-title">Help</h3>

                <div class="help-body">
                    <h4>Quick start</h4>
                    <ol>
                        <li>Click <b>New</b> and enter a title (and choose a layout).</li>
                        <li>Add thoughts using <b>Add thought (with notes)</b>.</li>
                        <li>Drag thoughts into the grid to rank them.</li>
                        <li>Click a thought to view notes. Use <b>Edit</b> to update.</li>
                    </ol>

                    <h4>Moving, returning, deleting</h4>
                    <ul>
                        <li><b>Return to tray:</b> click the ↩ icon on a thought (when it’s on the grid).</li>
                        <li><b>Delete:</b> drag a thought into the <b>Bin</b> area.</li>
                        <li><b>Drop on the top scale:</b> drops into the nearest empty cell in that column.</li>
                    </ul>

                    <h4>Column labels</h4>
                    <ul>
                        <li>Set labels when creating a new sort (in the New modal).</li>
                        <li>Edit labels anytime via <b>Menu → Edit column labels…</b>.</li>
                        <li>Labels are saved in local saves + JSON exports.</li>
                    </ul>

                    <h4>Saving and loading</h4>
                    <ul>
                        <li><b>Save local:</b> stores your work in this browser (easy “continue later”).</li>
                        <li><b>Export JSON:</b> downloads a file you can share or import later.</li>
                        <li><b>Load local / Load JSON:</b> restores everything (grid, notes, labels).</li>
                    </ul>

                    <h4>Presets</h4>
                    <ul>
                        <li>Open <b>Menu → Presets…</b> to browse and load example Q-sorts.</li>
                    </ul>

                    <h4>Printing</h4>
                    <ul>
                        <li>Use <b>Menu → Print</b> to print the grid and notes summary.</li>
                    </ul>

                    <h4>Troubleshooting</h4>
                    <ul>
                        <li>If drag-and-drop feels “stuck”, try refreshing the page.</li>
                        <li>If a save won’t load, check it’s a Q-sort JSON (version 3).</li>
                    </ul>
                </div>

                <div class="modal-actions">
                    <button id="help-close" class="btn primary" type="button">Close</button>
                </div>
            </div>
        </div>

    </main>
</body>

</html>